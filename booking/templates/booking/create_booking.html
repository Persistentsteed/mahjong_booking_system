<!-- booking/templates/booking/create_booking.html -->
{% extends 'booking/base.html' %}
{% block title %}预约 - {{ store.name }}{% endblock %}

{% block content %}
    <h1>为 {{ store.name }} 提交预约</h1>
    
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li class="{{ message.tags }}">{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <form method="post" id="booking-form">
        {% csrf_token %}
        <div>
            <label>预约类型:</label>
            <!-- 确保 radio 按钮的 name 属性是 booking_type -->
            <input type="radio" name="booking_type" value="GAMES" id="type_games" checked>
            <label for="type_games">按半庄数</label>
            <input type="radio" name="booking_type" value="DURATION" id="type_duration">
            <label for="type_duration">按时间段</label>
        </div>

        <div id="games_fields">
            <p>
                <label for="start_time_games">开始时间:</label><br>
                <!-- GAMES 类型下的开始时间输入框，name 属性清晰 -->
                <input type="datetime-local" id="start_time_games" name="start_time_games" required>
            </p>
            <p>
                <label for="num_games">半庄数:</label><br>
                <input type="number" id="num_games" name="num_games" value="4" min="0" required>
            </p>
        </div>

        <div id="duration_fields" style="display:none;">
            <p>
                <label for="start_time_duration">开始时间:</label><br>
                <!-- DURATION 类型下的开始时间输入框，name 属性清晰 -->
                <input type="datetime-local" id="start_time_duration" name="start_time_duration">
            </p>
            <p>
                <label for="end_time_duration">结束时间:</label><br>
                <!-- DURATION 类型下的结束时间输入框，name 属性清晰 -->
                <input type="datetime-local" id="end_time_duration" name="end_time_duration">
            </p>
        </div>
        <button type="submit">提交预约</button>
    </form>
    <script>
      const form = document.getElementById('booking-form');
      const gamesFields = document.getElementById('games_fields');
      const durationFields = document.getElementById('duration_fields');
      
      // 获取所有的输入框元素
      const gamesStartInput = document.getElementById('start_time_games');
      const gamesNumInput = document.getElementById('num_games');
      const durationStartInput = document.getElementById('start_time_duration');
      const durationEndInput = document.getElementById('end_time_duration'); // 修正 ID 和 name

      // 页面加载时根据默认选中状态设置
      window.onload = function() {
          if (document.getElementById('type_duration').checked) {
              gamesFields.style.display = 'none';
              durationFields.style.display = 'block';
              // DURATION 模式下，设置 GAMES 字段非必须，DURATION 字段必须
              gamesStartInput.required = false;
              gamesNumInput.required = false;
              durationStartInput.required = true;
              durationEndInput.required = true;
          } else { // GAMES 模式
              gamesFields.style.display = 'block';
              durationFields.style.display = 'none';
              // GAMES 模式下，设置 GAMES 字段必须，DURATION 字段非必须
              gamesStartInput.required = true;
              gamesNumInput.required = true;
              durationStartInput.required = false;
              durationEndInput.required = false;
          }
      };

      form.addEventListener('change', (e) => {
        if (e.target.name === 'booking_type') {
          if (e.target.value === 'GAMES') {
            gamesFields.style.display = 'block';
            durationFields.style.display = 'none';
            // 设置 required 属性
            gamesStartInput.required = true;
            gamesNumInput.required = true;
            durationStartInput.required = false;
            durationEndInput.required = false;
          } else { // DURATION
            gamesFields.style.display = 'none';
            durationFields.style.display = 'block';
            // 设置 required 属性
            gamesStartInput.required = false;
            gamesNumInput.required = false;
            durationStartInput.required = true;
            durationEndInput.required = true;
          }
        }
      });
    </script>
{% endblock %}